(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{116:function(e,n,r){"use strict";r.r(n),r.d(n,"frontMatter",(function(){return c})),r.d(n,"metadata",(function(){return l})),r.d(n,"toc",(function(){return i})),r.d(n,"default",(function(){return d}));var t=r(3),a=r(7),o=(r(0),r(209)),c={slug:"decorator",title:"\u7ed3\u6784\u578b | \u88c5\u9970\u6a21\u5f0f",author:"Zhao chen",author_url:"https://github.com/zhaocchen",tags:[],draft:!1,description:null},l={unversionedId:"design-pattern/decorator",id:"design-pattern/decorator",isDocsHomePage:!1,title:"\u7ed3\u6784\u578b | \u88c5\u9970\u6a21\u5f0f",description:"\u76f8\u6bd4\u751f\u6210\u5b50\u7c7b\u66f4\u52a0\u7075\u6d3b\u3002",source:"@site/docs/design-pattern/decorator.md",slug:"/design-pattern/decorator",permalink:"/docs/design-pattern/decorator",editUrl:"https://github.com/zhaocchen/zhaocchen.github.io/blob/master/docs/design-pattern/decorator.md",version:"current",sidebar:"docs",previous:{title:"\u7ed3\u6784\u578b | \u7ec4\u5408\u6a21\u5f0f",permalink:"/docs/design-pattern/composite"},next:{title:"\u7ed3\u6784\u578b | \u5916\u89c2\u6a21\u5f0f",permalink:"/docs/design-pattern/facade"}},i=[{value:"\u610f\u56fe",id:"\u610f\u56fe",children:[]},{value:"\u573a\u666f",id:"\u573a\u666f",children:[]},{value:"\u7f3a\u70b9",id:"\u7f3a\u70b9",children:[]},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0",children:[]},{value:"\u80cc\u666f",id:"\u80cc\u666f",children:[]},{value:"\u4ecb\u7ecd",id:"\u4ecb\u7ecd",children:[]},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0-1",children:[{value:"\u9762\u5411\u5bf9\u8c61\u5b9e\u73b0",id:"\u9762\u5411\u5bf9\u8c61\u5b9e\u73b0",children:[]},{value:"\u57fa\u4e8e\u5bf9\u8c61\u5b9e\u73b0",id:"\u57fa\u4e8e\u5bf9\u8c61\u5b9e\u73b0",children:[]},{value:"ES7\u5b9e\u73b0\uff08\u8bed\u6cd5\u7cd6\uff09",id:"es7\u5b9e\u73b0\uff08\u8bed\u6cd5\u7cd6\uff09",children:[]}]}],p={toc:i};function d(e){var n=e.components,r=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(t.a)({},p,r,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"\u76f8\u6bd4\u751f\u6210\u5b50\u7c7b\u66f4\u52a0\u7075\u6d3b\u3002"),Object(o.b)("h3",{id:"\u610f\u56fe"},"\u610f\u56fe"),Object(o.b)("p",null,"\u52a8\u6001\u5730\u7ed9\u4e00\u4e2a\u5bf9\u8c61\u6dfb\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u804c\u8d23\uff0c \u540c\u65f6\u4e0d\u6539\u53d8\u539f\u6709\u5185\u90e8\u7ed3\u6784\u3002"),Object(o.b)("h3",{id:"\u573a\u666f"},"\u573a\u666f"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"\u9700\u8981\u4e0d\u4fee\u6539\u4ee3\u7801\u60c5\u51b5\u4e0b\u4f7f\u7528\u5bf9\u8c61\uff0c \u4e14\u8981\u6c42\u8fd0\u884c\u65f6\u4e3a\u5bf9\u8c61\u65b0\u589e\u989d\u5916\u7684\u884c\u4e3a"),Object(o.b)("li",{parentName:"ul"},"\u7528\u7ee7\u627f\u6765\u6269\u5c55\u5bf9\u8c61\u884c\u4e3a\u7684\u65b9\u6848\u96be\u4ee5\u5b9e\u73b0\u6216\u8005\u6839\u672c\u4e0d\u53ef\u884c")),Object(o.b)("p",null,"\u5e94\u7528\uff1a"),Object(o.b)("h3",{id:"\u7f3a\u70b9"},"\u7f3a\u70b9"),Object(o.b)("p",null,"\u591a\u5c42\u88c5\u9970\u6bd4\u8f83\u590d\u6742"),Object(o.b)("h3",{id:"\u5b9e\u73b0"},"\u5b9e\u73b0"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-ts"},'// 1. \u521b\u5efa\u4e00\u4e2a\u63a5\u53e3\ninterface Shape {\n  draw(): void;\n}\n\n// 2. \u521b\u5efa\u5b9e\u73b0\u63a5\u53e3\u7684\u5b9e\u4f53\u7c7b\nclass Rectangle implements Shape {\n  public draw(): void {\n    console.log("Shape: Rectangle");\n  }\n}\n\nclass Circle implements Shape {\n  public draw(): void {\n    console.log("Shape: Circle");\n  }\n}\n\n// 3. \u521b\u5efa\u5b9e\u73b0\u4e86 Shape \u63a5\u53e3\u7684\u62bd\u8c61\u88c5\u9970\u7c7b\nabstract class ShapeDecorator implements Shape {\n  protected decoratedShape: Shape;\n  constructor(decoratedShape: Shape) {\n    this.decoratedShape = decoratedShape;\n  }\n\n  public draw(): void {\n    this.decoratedShape.draw();\n  }\n}\n\n// 4. \u521b\u5efa\u6269\u5c55\u4e86 ShapeDecorator \u7c7b\u7684\u5b9e\u4f53\u88c5\u9970\u7c7b\nclass RedShapeDecorator extends ShapeDecorator {\n  constructor(decoratedShape: Shape) {\n    super(decoratedShape);\n  }\n\n  public draw(): void {\n    this.decoratedShape.draw();\n    this.setRedBorder(this.decoratedShape);\n  }\n  \n  private setRedBorder(decoratedShape: Shape): void {\n    console.log("Border Color: Red");\n  }\n}\n')),Object(o.b)("p",null,"\u6d4b\u8bd5"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-ts"},'// 5. \u4f7f\u7528 RedShapeDecorator \u6765\u88c5\u9970 Shape \u5bf9\u8c61\nclass DecoratorPatternDemo {\n  circle: Shape = new Circle();\n  redCircle: ShapeDecorator = new RedShapeDecorator(new Circle());\n  redRectangle: ShapeDecorator = new RedShapeDecorator(new Rectangle());\n  constructor() {\n    console.log("Circle with normal border");\n    this.circle.draw();\n\n    console.log("\\nCircle of red border");\n    this.redCircle.draw();\n\n    console.log("\\nRectangle of red border");\n    this.redRectangle.draw();\n  }\n}\n\nnew DecoratorPatternDemo();\n// Circle with normal border\n// Shape: Circle\n\n// Circle of red border\n// Shape: Circle\n// Border Color: Red\n\n// Rectangle of red border\n// Shape: Rectangle\n// Border Color: Red\n')),Object(o.b)("hr",null),Object(o.b)("h2",{id:"\u80cc\u666f"},"\u80cc\u666f"),Object(o.b)("p",null,"ES7\u65b0\u7279\u6027\uff0c\u88c5\u9970\u5668"),Object(o.b)("p",null,"\u9762\u8bd5\uff1a"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"\u8bf7\u4ecb\u7ecd\u4e00\u4e0b\u88c5\u9970\u8005\u6a21\u5f0f\uff0c\u5e76\u5b9e\u73b0\uff1f")),Object(o.b)("h2",{id:"\u4ecb\u7ecd"},"\u4ecb\u7ecd"),Object(o.b)("p",null,"\u88c5\u9970\u8005\u6a21\u5f0f\uff0c\u662f\u52a8\u6001\u7684\u7ed9\u7c7b\uff08\u5bf9\u8c61\uff09\u589e\u52a0\u804c\u8d23\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c \u5c5e\u4e8e\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\u7ed3\u6784\u578b\u6a21\u5f0f\u5927\u7c7b\u3002\n\u5728\u4e0d\u6539\u53d8\u5143\u5bf9\u8c61\u7684\u57fa\u7840\u4e0a\uff0c \u5bf9\u8fd9\u4e2a\u5bf9\u8c61\u8fdb\u884c\u5305\u88c5\u76d2\u62d3\u5c55\uff0c \u4ece\u800c\u4f7f\u5bf9\u8c61\u6709\u66f4\u52a0\u590d\u6742\u7684\u529f\u80fd"),Object(o.b)("h2",{id:"\u5b9e\u73b0-1"},"\u5b9e\u73b0"),Object(o.b)("h3",{id:"\u9762\u5411\u5bf9\u8c61\u5b9e\u73b0"},"\u9762\u5411\u5bf9\u8c61\u5b9e\u73b0"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"var Car = function () {};\nCar.prototype.drive = function () {\n    console.log('\u539f\u59cb\u65b9\u6cd5');\n}\n\nvar AutopilotDecorator = function (car) {\n    this.car = car;\n}\nAutopilotDecorator.prototype.drive = function () {\n    this.car.drive();\n    console.log('\u52a0\u5f3a\u65b9\u6cd5');\n}\n\nvar car = new Car();\ncar = new AutopilotDecorator(car);\ncar.drive();\n\n// \u539f\u59cb\u65b9\u6cd5\n// \u52a0\u5f3a\u65b9\u6cd5\n")),Object(o.b)("p",null,"\u591a\u4e2a\u88c5\u9970\u5668"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"var Car = function () {};\nCar.prototype.drive = function () {\n    console.log('\u539f\u59cb\u65b9\u6cd5');\n}\nCar.prototype.brake = function () {\n    console.log('\u539f\u59cb\u65b9\u6cd52');\n}\n\n// \u88c5\u9970\u5668\u7236\u7c7b\nvar CarDecorator = function (car) {\n    this.car = car;\n}\nCarDecorator.prototype = {\n    drive: function () {\n        this.car.drive();\n    },\n    brake: function () {\n        this.car.brake();\n    }\n}\n\n// \u88c5\u9970\u56681\nvar AutopilotDecorator = function (car) {\n    CarDecorator.call(this, car);\n}\nAutopilotDecorator.prototype = new CarDecorator();\nAutopilotDecorator.prototype.drive = function () {\n    this.car.drive();\n    console.log('\u52a0\u5f3a\u65b9\u6cd5');\n}\n\n// \u88c5\u9970\u56682\nvar HybridDecorator = function (car) {\n    CarDecorator.call(this, car);\n}\nHybridDecorator.prototype = new CarDecorator();\nHybridDecorator.prototype.brake = function () {\n    this.car.brake();\n    console.log('\u52a0\u5f3a\u65b9\u6cd52');\n}\n\nvar car = new Car();\ncar = new AutopilotDecorator(car);\ncar = new HybridDecorator(car);\ncar.drive();\ncar.brake();\n\n// \u539f\u59cb\u65b9\u6cd5\n// \u52a0\u5f3a\u65b9\u6cd5\n// \u539f\u59cb\u65b9\u6cd52\n// \u52a0\u5f3a\u65b9\u6cd52\n")),Object(o.b)("h3",{id:"\u57fa\u4e8e\u5bf9\u8c61\u5b9e\u73b0"},"\u57fa\u4e8e\u5bf9\u8c61\u5b9e\u73b0"),Object(o.b)("p",null,"\u7528\u4e00\u4e2a\u53d8\u91cf\u6765\u4fdd\u5b58\u539f\u51fd\u6570\u7684\u5f15\u7528\uff0c\u7136\u540e\u518d\u91cd\u5199 drive \u65b9\u6cd5"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"var car = {\n    drive: function () {\n        console.log('\u539f\u59cb\u65b9\u6cd5');\n    }\n};\n\nvar driveBasic = car.drive;\n\nvar autopilotDecorator = function() {\n    console.log('\u52a0\u5f3a\u65b9\u6cd5');\n}\n\nvar car1 = Object.create(car);\ncar1.drive = function () {\n    driveBasic();\n    autopilotDecorator();\n}\ncar1.drive();\n\n// \u539f\u59cb\u65b9\u6cd5\n// \u52a0\u5f3a\u65b9\u6cd5\n")),Object(o.b)("p",null,"\u5de5\u5177\u51fd\u6570\uff0c \u8f85\u52a9\u88c5\u9970\u51fd\u6570"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"Function.prototype.after = function (dec) {\n    return () => {\n        var ret = this.apply(this, arguments);\n        dec.apply(this.arguments); // \u88c5\u9970\u51fd\u6570\n        return ret;\n    }\n}\n\nvar car = {\n    drive: function () {\n        console.log('\u539f\u59cb\u65b9\u6cd5');\n    }\n};\n\nvar autopilotDecorator = function() {\n    console.log('\u52a0\u5f3a\u65b9\u6cd5');\n}\n\nvar car1 = Object.create(car);\ncar1.drive = car.drive.after(autopilotDecorator);  // \u91cd\u5199\ncar1.drive();\n\n// \u539f\u59cb\u65b9\u6cd5\n// \u52a0\u5f3a\u65b9\u6cd5\n")),Object(o.b)("h3",{id:"es7\u5b9e\u73b0\uff08\u8bed\u6cd5\u7cd6\uff09"},"ES7\u5b9e\u73b0\uff08\u8bed\u6cd5\u7cd6\uff09"),Object(o.b)("p",null,"\u65b9\u6cd5\u88c5\u9970\u5668"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"function autopilotDecorator (target, key, descriptor) {\n    const method = descriptor.value;\n    descriptor.value = () => {\n        method(target);\n        console.log('\u52a0\u5f3a\u65b9\u6cd5');\n    }\n}\n\nclass Car {\n    @autopilotDecorator\n    drive() {\n        console.log('\u539f\u59cb\u65b9\u6cd5');\n    }\n};\n\nvar car1 = new Car();\ncar1.drive();\n\n// \u539f\u59cb\u65b9\u6cd5\n// \u52a0\u5f3a\u65b9\u6cd5\n")),Object(o.b)("p",null,"\u7c7b\u88c5\u9970\u5668\n\u51fd\u6570\u65b9\u6cd5\u88c5\u9970\u5668"),Object(o.b)("h4",{id:"\u5e94\u7528-react\u4e2d\u9ad8\u9636\u7ec4\u4ef6\u4f5c\u4e3a\u88c5\u9970\u5668"},"\u5e94\u7528 react\u4e2d\u9ad8\u9636\u7ec4\u4ef6\u4f5c\u4e3a\u88c5\u9970\u5668"),Object(o.b)("p",null," \u9700\u8981\u903b\u8f91\u590d\u7528\u65f6\uff0cHOC\u63a5\u53d7\u4e00\u4e2areact\u7ec4\u4ef6\uff0c \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684react\u7ec4\u4ef6\u3002"),Object(o.b)("h4",{id:"\u5e94\u7528-\u88c5\u9970\u5668\u6a21\u5f0f\u589e\u5f3afetch"},"\u5e94\u7528 \u88c5\u9970\u5668\u6a21\u5f0f\u589e\u5f3afetch"),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://mp.weixin.qq.com/s/1ptRKOXMMe6pjU0jvu5tAw"},"https://mp.weixin.qq.com/s/1ptRKOXMMe6pjU0jvu5tAw")),Object(o.b)("h4",{id:"\u73af\u5883"},"\u73af\u5883"),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://babeljs.io/docs/en/babel-plugin-proposal-decorators"},"https://babeljs.io/docs/en/babel-plugin-proposal-decorators")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"yarn init -y\ntouch index.js\nyarn add @babel/core @babel/cli @babel/preset-env --dev\nyarn add @babel/plugin-proposal-decorators --dev\n")),Object(o.b)("p",null,"\u547d\u4ee4\u884c"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-json"},'  // package.json\n  "scripts": {\n    "build": "babel index.js -o compiled.js && node compiled.js"\n  },\n  "keywords": [\n    "babel"\n  ],\n')),Object(o.b)("p",null,"\u914d\u7f6e\u6587\u4ef6"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-json"},'// .babelrc\n{\n    "presets": ["@babel/preset-env"],\n    "plugins": [["@babel/plugin-proposal-decorators", {"legacy": true }]]\n}\n')),Object(o.b)("p",null,"\u539f\u7406"),Object(o.b)("h4",{id:"ts"},"ts"),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://www.typescriptlang.org/docs/handbook/decorators.html"},"https://www.typescriptlang.org/docs/handbook/decorators.html"),"\n",Object(o.b)("a",{parentName:"p",href:"https://www.tslang.cn/docs/handbook/decorators.html"},"https://www.tslang.cn/docs/handbook/decorators.html")),Object(o.b)("p",null,"\u53c2\u8003\uff1a\n",Object(o.b)("a",{parentName:"p",href:"https://github.com/lgwebdream/FE-Interview/issues/1057"},"https://github.com/lgwebdream/FE-Interview/issues/1057")))}d.isMDXComponent=!0},209:function(e,n,r){"use strict";r.d(n,"a",(function(){return b})),r.d(n,"b",(function(){return h}));var t=r(0),a=r.n(t);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function c(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?c(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function i(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=a.a.createContext({}),d=function(e){var n=a.a.useContext(p),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},b=function(e){var n=d(e.components);return a.a.createElement(p.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},u=a.a.forwardRef((function(e,n){var r=e.components,t=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),b=d(r),u=t,h=b["".concat(c,".").concat(u)]||b[u]||s[u]||o;return r?a.a.createElement(h,l(l({ref:n},p),{},{components:r})):a.a.createElement(h,l({ref:n},p))}));function h(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var o=r.length,c=new Array(o);c[0]=u;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l.mdxType="string"==typeof e?e:t,c[1]=l;for(var p=2;p<o;p++)c[p]=r[p];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,r)}u.displayName="MDXCreateElement"}}]);