(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{101:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return c})),t.d(n,"metadata",(function(){return o})),t.d(n,"toc",(function(){return i})),t.d(n,"default",(function(){return p}));var a=t(3),l=t(7),r=(t(0),t(209)),c={slug:"\u5982\u4f55\u5c06webpack3\u5347\u7ea7\u81f3webpack4",title:"\u5982\u4f55\u5c06webpack3\u5347\u7ea7\u81f3webpack4",author:"Zhao chen",author_url:"https://github.com/zhaocchen",tags:[]},o={permalink:"/blog/\u5982\u4f55\u5c06webpack3\u5347\u7ea7\u81f3webpack4",editUrl:"https://github.com/zhaocchen/zhaocchen.github.io/blob/master/blog/2020-12-26-webpack3to4.md",source:"@site/blog/2020-12-26-webpack3to4.md",description:"\u80cc\u666f",date:"2020-12-26T00:00:00.000Z",formattedDate:"December 26, 2020",tags:[],title:"\u5982\u4f55\u5c06webpack3\u5347\u7ea7\u81f3webpack4",readingTime:3.445,truncated:!1,prevItem:{title:"\u65b0\u8d77\u70b9\u7684\u601d\u8003",permalink:"/blog/weekly240"},nextItem:{title:"\u5982\u4f55\u4f7f\u7528parcel\u5b9e\u73b0\u96f6\u914d\u7f6e\u6253\u5305",permalink:"/blog/\u5982\u4f55\u4f7f\u7528parcel\u5b9e\u73b0\u96f6\u914d\u7f6e\u6253\u5305"}},i=[{value:"\u80cc\u666f",id:"\u80cc\u666f",children:[]},{value:"\u9488\u5bf9development",id:"\u9488\u5bf9development",children:[]},{value:"\u9488\u5bf9production",id:"\u9488\u5bf9production",children:[]},{value:"\u5f71\u54cd\u4e0d\u5927\u7684\u5347\u7ea7",id:"\u5f71\u54cd\u4e0d\u5927\u7684\u5347\u7ea7",children:[]}],s={toc:i};function p(e){var n=e.components,t=Object(l.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("h3",{id:"\u80cc\u666f"},"\u80cc\u666f"),Object(r.b)("p",null,"\u539f\u9879\u76ee\u7531vue-cli2\u5feb\u901f\u6784\u5efa\uff0c \u51e0\u5e74\u8fc7\u53bb\u4e86webpack5\u5df2\u7ecf\u53d1\u5e03\uff0c\u8feb\u4e8e\u9879\u76ee\u9010\u6e10\u6269\u5927\u4e14\u4e1a\u52a1\u9700\u6c42\uff0c webpack\u7248\u672c\u5347\u7ea7\u8feb\u5728\u7709\u776b\u3002\n\u4ee5\u4e0b\u8bb0\u5f55\u4e86\u5347\u7ea7\u8fc7\u7a0b\u53ca\u95ee\u9898\u89e3\u51b3\u65b9\u6848"),Object(r.b)("h4",{id:"\u96be\u70b9"},"\u96be\u70b9"),Object(r.b)("p",null,"\u76f8\u5173\u6700\u65b0\u5b89\u88c5\u5305\u4e0d\u5339\u914d\u9020\u6210\u65e0\u6cd5\u6309\u7167\u9884\u671f\u8fd0\u884c"),Object(r.b)("h3",{id:"\u9488\u5bf9development"},"\u9488\u5bf9development"),Object(r.b)("h4",{id:"\u5347\u7ea7webpack\u53ca\u5468\u8fb9"},"\u5347\u7ea7webpack\u53ca\u5468\u8fb9"),Object(r.b)("p",null,"\u26a0\ufe0fwebpack-dev-server\u9700\u8981\u4e0ewebpack\u5339\u914d\uff0c \u5426\u5219\u62a5\u9519"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-powershell"},'"webpack": "^4.44.2",  // 3.6.0 -> 4.44.2\n"webpack-cli": "^3.3.12", // add\n"webpack-dev-server": "^3.11.0", // 2.9.1 -> 3.11.0\n npm i -D webpack-bundle-analyzer@latest  // 2.9.0 -> 4.3.0\n')),Object(r.b)("h4",{id:"\u6dfb\u52a0mode-\uff08v4\u65b0\uff09"},"\u6dfb\u52a0mode \uff08v4\u65b0\uff09"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},"mode: process.env.NODE_ENV === 'production' ? 'production' : 'development',\n")),Object(r.b)("h4",{id:"\u53c2\u7167\u5b98\u7f51\u6307\u5357\uff0c-\u79fb\u9664\u5e9f\u5f03api"},"\u53c2\u7167\u5b98\u7f51\u6307\u5357\uff0c \u79fb\u9664\u5e9f\u5f03API"),Object(r.b)("p",null,Object(r.b)("a",{parentName:"p",href:"https://v4.webpack.docschina.org/migrate/4/"},"https://v4.webpack.docschina.org/migrate/4/")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u79fb\u9664",Object(r.b)("inlineCode",{parentName:"li"},"NamedModulesPlugin"),",",Object(r.b)("inlineCode",{parentName:"li"},"NoEmitOnErrorsPlugin"),"\u63d2\u4ef6")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},"// new webpack.NamedModulesPlugin(), // HMR shows correct file names in console on update.\n// new webpack.NoEmitOnErrorsPlugin(),\n")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u79fb\u9664DefinePlugin"),Object(r.b)("li",{parentName:"ul"},"UglifyJsPlugin")),Object(r.b)("p",null,"\u200b"),Object(r.b)("h4",{id:"\u5347\u7ea7html\u7f16\u8bd1\u63d2\u4ef6html-webpack-plugin"},"\u5347\u7ea7html\u7f16\u8bd1\u63d2\u4ef6html-webpack-plugin"),Object(r.b)("p",null,"\u9519\u8bef\u63d0\u793a\uff1acompilation.mainTemplate.applyPluginsWaterfall('asset-path', outputOptions.filename"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-powershell"},"npm i html-webpack-plugin@latest --dev // 2.30.1 -> 4.5.0\n")),Object(r.b)("h4",{id:"\u5347\u7ea7vue-loader\uff0c\u4f7f\u7528vueloaderplugin\u66ff\u6362vueloaderconfig"},"\u5347\u7ea7vue-loader\uff0c\u4f7f\u7528VueLoaderPlugin\u66ff\u6362vueLoaderConfig"),Object(r.b)("p",null,"\u9519\u8bef\u63d0\u793a\uff1a Cannot read property 'vue' of undefined"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-powershell"},"npm i -D vue-loader@latest // 13.3.0 -> 15.9.6\n")),Object(r.b)("p",null,"\u79fb\u9664vueLoaderConfig\uff0c \u589e\u52a0VueLoaderPlugin\n\u26a0\ufe0f  options \u5b57\u6bb5\u6539\u4e3a loader"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},"//const vueLoaderConfig = require('./vue-loader.conf')\nconst { VueLoaderPlugin } = require('vue-loader')\nmodule.exports = {\n  ...,\n  module: {\n    rules: [\n      {\n        test: /\\.vue$/,\n        loader: 'vue-loader',\n       // options: vueLoaderConfig\n      },\n    ]\n  },\n plugins: [\n   new VueLoaderPlugin()\n ]\n}\n")),Object(r.b)("h4",{id:"\u79fb\u9664webpack-dev-serverclient"},"\u79fb\u9664webpack-dev-server/client"),Object(r.b)("p",null,"\u9519\u8bef\u63d0\u793a\uff1aCannot assign to read only property 'exports' of object '","[object Object]","'\n\u79fb\u9664resolve('node_modules/webpack-dev-server/client')\n\u200b"),Object(r.b)("h3",{id:"\u9488\u5bf9production"},"\u9488\u5bf9production"),Object(r.b)("h4",{id:"\u5e9f\u5f03commonschunkplugin\u7531optimization-\u4ee3\u66ff"},"\u5e9f\u5f03CommonsChunkPlugin\u7531optimization \u4ee3\u66ff"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"webpack.optimize.CommonsChunkPlugin has been removed")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"vendor"),Object(r.b)("li",{parentName:"ul"},"manifest"),Object(r.b)("li",{parentName:"ul"},"vendor-async")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},"plugins: [\n    // new webpack.optimize.CommonsChunkPlugin({\n    //   name: 'vendor',\n    //   minChunks (module) {\n    //     // any required modules inside node_modules are extracted to vendor\n    //     return (\n    //       module.resource &&\n    //       /\\.js$/.test(module.resource) &&\n    //       module.resource.indexOf(\n    //         path.join(__dirname, '../node_modules')\n    //       ) === 0\n    //     )\n    //   }\n    // }),\n    // new webpack.optimize.CommonsChunkPlugin({\n    //   name: 'manifest',\n    //   minChunks: Infinity\n    // }),\n    // new webpack.optimize.CommonsChunkPlugin({\n    //   name: 'app',\n    //   async: 'vendor-async',\n    //   children: true,\n    //   minChunks: 3\n    // }),\n]\n  optimization: {\n    // minimize: true,\n    splitChunks: {\n      cacheGroups: {\n        vendors: {\n          test: /[\\\\/]node_modules[\\\\/]/,\n          chunks: 'initial',\n          name: 'vendors',\n        },\n        'async-vendors': {\n          test: /[\\\\/]node_modules[\\\\/]/,\n          minChunks: 3,\n          chunks: 'async',\n          name: 'async-vendors',\n        },\n        manifest: {\n          test: /[\\\\/]src[\\\\/]/,\n          minSize: 0,\n          minChunks: 2,\n          priority: 9\n        }\n      }\n    }\n  }\n")),Object(r.b)("h4",{id:"\u5e9f\u5f03extract-text-webpack-plugin\u7531mini-css-extract-plugin\u4ee3\u66ff"},"\u5e9f\u5f03extract-text-webpack-plugin\u7531mini-css-extract-plugin\u4ee3\u66ff"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Chunk.entrypoints: Use Chunks.groupsIterable and filter")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-powershell"},"extract-text-webpack-plugin // remove\nnpm i mini-css-extract-plugin@latest --dev\n")),Object(r.b)("p",null,"webpack.prod.js"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},"// const ExtractTextPlugin = require('extract-text-webpack-plugin')\n// new ExtractTextPlugin({\n//   filename: utils.assetsPath('css/[name].[contenthash].css'),\n//   // Setting the following option to `false` will not extract CSS from codesplit chunks.\n//   // Their CSS will instead be inserted dynamically with style-loader when the codesplit chunk has been loaded by webpack.\n//   // It's currently set to `true` because we are seeing that sourcemaps are included in the codesplit bundle as well when it's `false`,\n//   // increasing file size: https://github.com/vuejs-templates/webpack/issues/1110\n//   allChunks: true\n// }),\n    \n  new MiniCssExtractPlugin({\n    filename: utils.assetsPath('css/[name].[contenthash].css'),\n    allChunks: true,\n    ignoreOrder: true\n  }), \n")),Object(r.b)("p",null,"\u544a\u8b66\uff1a WARNING in chunk 1 ","[mini-css-extract-plugin]","\nConflicting order.\xa0"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},"ignoreOrder: true\n")),Object(r.b)("p",null,"utils.js"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},"    if (options.extract) {\n      // return ExtractTextPlugin.extract({\n      //   use: loaders,\n      //   fallback: 'vue-style-loader'\n      // })\n      return [MiniCssExtractPlugin.loader].concat(loaders)\n    }\n")),Object(r.b)("h4",{id:"\u4fee\u6539chunkssortmode"},"\u4fee\u6539chunksSortMode"),Object(r.b)("p",null,'\u9519\u8bef\u63d0\u793a\uff1a Unhandled rejection Error: "dependency" is not a valid chunk sort mode'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},"// HtmlWebpackPlugin \u4e2d\u914d\u7f6e\nchunksSortMode: 'auto'\n")),Object(r.b)("h4",{id:"\u544a\u8b66\uff1a-unhandled-rejection-error-dependency-is-not-a-valid-chunk-sort-mode"},'\u544a\u8b66\uff1a Unhandled rejection Error: "dependency" is not a valid chunk sort mode'),Object(r.b)("p",null,"WARNING in asset size limit: The following asset(s) exceed the recommended size limit (244 KiB).\nThis can impact web performance.\n\u200b"),Object(r.b)("h4",{id:"\u5347\u7ea7\u6210\u679c\uff1a-\u6253\u5305\u65f6\u95f4\u63d0\u5347-265-\u4f53\u79ef\u51cf\u5c0f655"},"\u5347\u7ea7\u6210\u679c\uff1a \u6253\u5305\u65f6\u95f4\u63d0\u5347 26.5%, \u4f53\u79ef\u51cf\u5c0f65.5%"),Object(r.b)("p",null,"13831ms  -> 10160ms    14.78s\n16M  -> 6M\n\u200b"),Object(r.b)("h3",{id:"\u5f71\u54cd\u4e0d\u5927\u7684\u5347\u7ea7"},"\u5f71\u54cd\u4e0d\u5927\u7684\u5347\u7ea7"),Object(r.b)("h4",{id:"\u5347\u7ea7webpack-merge"},"\u5347\u7ea7webpack-merge"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"}," npm i webpack-merge@latest --dev // 4.1.0 -> 5.7.3\n// error merge is not a function\nconst {merge} = reuqire('webpack-merge')\n")),Object(r.b)("h4",{id:"\u5347\u7ea7webpack-bundle-analyzer"},"\u5347\u7ea7webpack-bundle-analyzer"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},'npm i -D webpack-bundle-analyzer@latest //  ^2.9.0 -> ^4.3.0\n\nif (config.build.bundleAnalyzerReport) {\n  const BundleAnalyzerPlugin = require(\'webpack-bundle-analyzer\').BundleAnalyzerPlugin\n  webpackConfig.plugins.push(new BundleAnalyzerPlugin())\n}\n\n"build:report": "npm_config_report=true node build_vue_script/build.js"\n')),Object(r.b)("h4",{id:"\u5347\u7ea7plugin"},"\u5347\u7ea7plugin"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"vue-template-compiler@latest \nfriendly-errors-webpack-plugin@latest \ncopy-webpack-plugin@latest \noptimize-css-assets-webpack-plugin@latest\n")),Object(r.b)("h4",{id:"\u5347\u7ea7css"},"\u5347\u7ea7css"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"npm install --save-dev css-loader@latest \nnpm install --save-dev postcss-loader@latest \npostcss-import@latest \npostcss-import@latest \nsass-loader@latest\n\nnpm install css-loader@latest \nfile-loader@latest \nurl-loader@latest \nless-loader@latest \npostcss-loader@latest \nvue-loader@latest \nvue-style-loader@latest -D\n")),Object(r.b)("p",null,"\u9519\u8bef\u63d0\u793a\uff1aError: true is not a PostCSS plugin"),Object(r.b)("h4",{id:""}),Object(r.b)("h4",{id:"\u5347\u7ea7eslint"},"\u5347\u7ea7eslint"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-powershell"},"npm i -D eslint@latest \neslint-loader@latest  \u5df2\u88ab\u5e9f\u5f03  \u66ff\u6362eslint-webpack-plugin\n\neslint-config-standard@latest \neslint-friendly-formatter@latest \neslint-plugin-import@latest \neslint-plugin-node@latest \neslint-plugin-promise@latest \neslint-plugin-standard@latest \neslint-plugin-vue@latest \neslint-plugin-html@latest\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-powershell"},"module.exports = {\n  // ...\n  module: {\n    rules: [\n      // {\n      //   test: /\\.js$/,\n      //   exclude: /node_modules/,\n      //   loader: 'eslint-loader',\n      //   options: {\n      //     // eslint options (if necessary)\n      //   },\n      // },\n    ],\n  },\n  // ...\n};\n\nconst ESLintPlugin = require('eslint-webpack-plugin');\n \nmodule.exports = {\n  // ...\n  plugins: [new ESLintPlugin(options)],\n  // ...\n};\n")),Object(r.b)("p",null,"\u53c2\u8003\uff1a"),Object(r.b)("p",null,Object(r.b)("a",{parentName:"p",href:"https://v4.webpack.js.org/concepts/"},"webpack4-documnet")))}p.isMDXComponent=!0},209:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return m}));var a=t(0),l=t.n(a);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=l.a.createContext({}),p=function(e){var n=l.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return l.a.createElement(s.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return l.a.createElement(l.a.Fragment,{},n)}},d=l.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),u=p(t),d=a,m=u["".concat(c,".").concat(d)]||u[d]||b[d]||r;return t?l.a.createElement(m,o(o({ref:n},s),{},{components:t})):l.a.createElement(m,o({ref:n},s))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,c=new Array(r);c[0]=d;var o={};for(var i in n)hasOwnProperty.call(n,i)&&(o[i]=n[i]);o.originalType=e,o.mdxType="string"==typeof e?e:a,c[1]=o;for(var s=2;s<r;s++)c[s]=t[s];return l.a.createElement.apply(null,c)}return l.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);